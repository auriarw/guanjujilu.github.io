<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>éŸ³ä¹å‰§è§‚æ¼”è®°å½•</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@400;600;700&family=Noto+Sans+SC:wght@300;400;500;600&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #8B2635;
            --primary-light: #A63446;
            --secondary: #D4AF37;
            --bg-main: #FFF9F0;
            --bg-card: #FFFFFF;
            --text-primary: #2C1810;
            --text-secondary: #6B5444;
            --border: #E8DDD0;
            --shadow: rgba(139, 38, 53, 0.1);
        }

        body {
            font-family: 'Noto Sans SC', sans-serif;
            background: linear-gradient(135deg, #FFF9F0 0%, #F5EDE0 100%);
            color: var(--text-primary);
            line-height: 1.6;
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            text-align: center;
            padding: 40px 20px;
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
            color: white;
            border-radius: 20px;
            margin-bottom: 40px;
            box-shadow: 0 10px 30px var(--shadow);
            position: relative;
            overflow: hidden;
        }

        h1 {
            font-family: 'Noto Serif SC', serif;
            font-size: 3em;
            font-weight: 700;
            margin-bottom: 10px;
            position: relative;
        }

        .subtitle {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .nav-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .nav-tab {
            padding: 12px 28px;
            background: var(--bg-card);
            border: 2px solid var(--border);
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
            color: var(--text-primary);
        }

        .nav-tab:hover {
            border-color: var(--primary);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px var(--shadow);
        }

        .nav-tab.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        .tab-content {
            display: none;
            animation: fadeIn 0.5s ease;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .card {
            background: var(--bg-card);
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 25px;
            box-shadow: 0 4px 15px var(--shadow);
            border: 1px solid var(--border);
        }

        .card-title {
            font-family: 'Noto Serif SC', serif;
            font-size: 1.8em;
            font-weight: 600;
            margin-bottom: 20px;
            color: var(--primary);
            border-bottom: 2px solid var(--secondary);
            padding-bottom: 10px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--text-secondary);
        }

        input, select, textarea {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid var(--border);
            border-radius: 10px;
            font-size: 1em;
            font-family: inherit;
            transition: all 0.3s ease;
            background: var(--bg-main);
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(139, 38, 53, 0.1);
        }

        textarea {
            resize: vertical;
            min-height: 100px;
        }

        .btn {
            padding: 12px 32px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1em;
            font-weight: 500;
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px var(--shadow);
        }

        .btn:hover {
            background: var(--primary-light);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px var(--shadow);
        }

        .btn-secondary {
            background: var(--secondary);
            color: var(--text-primary);
        }

        .btn-secondary:hover {
            background: #C5A028;
        }

        .btn-small {
            padding: 6px 16px;
            font-size: 0.9em;
        }

        .records-list {
            display: grid;
            gap: 15px;
        }

        .record-item {
            background: var(--bg-main);
            padding: 20px;
            border-radius: 12px;
            border-left: 4px solid var(--primary);
            transition: all 0.3s ease;
        }

        .record-item:hover {
            box-shadow: 0 4px 15px var(--shadow);
            transform: translateX(5px);
        }

        .record-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 12px;
            flex-wrap: wrap;
            gap: 10px;
        }

        .record-title {
            font-family: 'Noto Serif SC', serif;
            font-size: 1.3em;
            font-weight: 600;
            color: var(--primary);
        }

        .record-type {
            display: inline-block;
            padding: 4px 12px;
            background: var(--secondary);
            color: var(--text-primary);
            border-radius: 15px;
            font-size: 0.85em;
            font-weight: 500;
        }

        .record-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            margin-top: 12px;
            font-size: 0.95em;
            color: var(--text-secondary);
        }

        .record-detail {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .record-actions {
            display: flex;
            gap: 10px;
            margin-top: 12px;
        }

        .calendar-container {
            background: var(--bg-card);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 4px 15px var(--shadow);
        }

        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .calendar-title {
            font-family: 'Noto Serif SC', serif;
            font-size: 1.5em;
            font-weight: 600;
            color: var(--primary);
        }

        .calendar-nav {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 10px;
        }

        .calendar-day-header {
            text-align: center;
            font-weight: 600;
            padding: 10px;
            color: var(--text-secondary);
        }

        .calendar-day {
            min-height: 120px;
            border: 2px solid var(--border);
            border-radius: 10px;
            padding: 0;
            position: relative;
            cursor: pointer;
            transition: all 0.3s ease;
            background: var(--bg-main);
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .calendar-day:hover {
            border-color: var(--primary);
            box-shadow: 0 2px 8px var(--shadow);
        }

        .calendar-day.has-show {
            border-color: var(--primary);
        }

        .calendar-day.other-month {
            opacity: 0.3;
        }

        .day-number {
            font-weight: 600;
            font-size: 0.9em;
            padding: 6px 8px;
            background: rgba(255, 255, 255, 0.9);
            position: absolute;
            top: 0;
            left: 0;
            z-index: 2;
            border-bottom-right-radius: 8px;
        }

        .calendar-day.has-show .day-number {
            background: rgba(139, 38, 53, 0.85);
            color: white;
        }

        .day-content {
            display: flex;
            flex-direction: column;
            gap: 4px;
            flex: 1;
            width: 100%;
        }

        .day-image-full {
            width: 100%;
            height: 100%;
            position: relative;
            overflow: hidden;
        }

        .day-image-full img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .day-image-overlay {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(to top, rgba(0, 0, 0, 0.8), transparent);
            color: white;
            font-size: 0.75em;
            padding: 6px 8px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .day-text-only {
            padding: 30px 8px 8px 8px;
            font-size: 0.8em;
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .day-text-item {
            padding: 4px;
            background: var(--primary);
            color: white;
            border-radius: 4px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            font-size: 0.85em;
        }

        .ranking-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 20px;
            background: var(--bg-main);
            border-radius: 10px;
            margin-bottom: 12px;
            transition: all 0.3s ease;
        }

        .ranking-item:hover {
            transform: translateX(5px);
            box-shadow: 0 2px 10px var(--shadow);
        }

        .ranking-number {
            font-family: 'Noto Serif SC', serif;
            font-size: 1.5em;
            font-weight: 700;
            color: var(--secondary);
            min-width: 50px;
        }

        .ranking-number.top {
            color: var(--primary);
            font-size: 2em;
        }

        .ranking-name {
            flex: 1;
            font-weight: 500;
            margin: 0 20px;
        }

        .ranking-count {
            font-size: 1.2em;
            font-weight: 600;
            color: var(--primary);
            min-width: 60px;
            text-align: right;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
            color: white;
            padding: 25px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 4px 15px var(--shadow);
        }

        .stat-number {
            font-family: 'Noto Serif SC', serif;
            font-size: 3em;
            font-weight: 700;
            display: block;
            margin-bottom: 10px;
        }

        .stat-label {
            font-size: 1em;
            opacity: 0.9;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            animation: fadeIn 0.3s ease;
        }

        .modal.active {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .modal-content {
            background: var(--bg-card);
            border-radius: 20px;
            padding: 30px;
            max-width: 500px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-title {
            font-family: 'Noto Serif SC', serif;
            font-size: 1.5em;
            font-weight: 600;
            color: var(--primary);
        }

        .close-btn {
            font-size: 1.5em;
            cursor: pointer;
            color: var(--text-secondary);
            background: none;
            border: none;
            padding: 0;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .close-btn:hover {
            color: var(--primary);
        }

        .image-upload {
            margin-top: 10px;
        }

        .image-preview {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 10px;
        }

        .image-preview-item {
            position: relative;
            width: 100px;
            height: 100px;
            border-radius: 8px;
            overflow: hidden;
            border: 2px solid var(--border);
        }

        .image-preview-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .image-remove {
            position: absolute;
            top: 5px;
            right: 5px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            cursor: pointer;
            font-size: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--text-secondary);
        }

        .empty-state-icon {
            font-size: 4em;
            margin-bottom: 20px;
            opacity: 0.5;
        }

        @media (max-width: 768px) {
            h1 {
                font-size: 2em;
            }

            .calendar-grid {
                gap: 5px;
            }

            .calendar-day {
                min-height: 100px;
            }

            .day-number {
                font-size: 0.75em;
                padding: 4px 6px;
            }

            .day-text-item {
                font-size: 0.75em;
                padding: 3px;
            }

            .day-image-overlay {
                font-size: 0.7em;
                padding: 4px 6px;
            }

            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>æˆ‘çš„è§‚æ¼”è®°å½•</h1>
            <div class="subtitle">å¤šçœ‹å¥½å‰§å°‘è¢«åˆ›</div>
        </header>

        <div class="nav-tabs">
            <div class="nav-tab active" onclick="switchTab('add')">â• æ·»åŠ è®°å½•</div>
            <div class="nav-tab" onclick="switchTab('list')">ğŸ“‹ æ‰€æœ‰è®°å½•</div>
            <div class="nav-tab" onclick="switchTab('calendar')">ğŸ“… æ—¥å†è§†å›¾</div>
            <div class="nav-tab" onclick="switchTab('shows')">ğŸ­ å‰§ç›®æ’è¡Œ</div>
            <div class="nav-tab" onclick="switchTab('actors')">â­ æ¼”å‘˜æ’è¡Œ</div>
            <div class="nav-tab" onclick="switchTab('summary')">ğŸ“Š ç»Ÿè®¡æ€»ç»“</div>
            <div class="nav-tab" onclick="switchTab('data')">ğŸ’¾ æ•°æ®ç®¡ç†</div>
        </div>

        <!-- æ·»åŠ è®°å½• -->
        <div id="tab-add" class="tab-content active">
            <div class="card">
                <h2 class="card-title">æ·»åŠ æ–°è®°å½•</h2>
                <form id="addForm">
                    <div class="form-group">
                        <label>å‰§ç›®åç§° *</label>
                        <input type="text" id="showName" required>
                    </div>
                    <div class="form-group">
                        <label>å‰§ç§ *</label>
                        <input type="text" id="showType" placeholder="ä¾‹å¦‚ï¼šéŸ³ä¹å‰§ã€æ­Œå‰§ã€è¯å‰§" required>
                    </div>
                    <div class="form-group">
                        <label>è§‚æ¼”æ—¥æœŸ *</label>
                        <input type="date" id="showDate" required>
                    </div>
                    <div class="form-group">
                        <label>å…·ä½“æ—¶é—´</label>
                        <input type="time" id="showTime">
                    </div>
                    <div class="form-group">
                        <label>å¡å¸ï¼ˆå¤šä¸ªæ¼”å‘˜ç”¨é€—å·åˆ†éš”ï¼‰</label>
                        <input type="text" id="showCast" placeholder="ä¾‹å¦‚ï¼šå¼ ä¸‰, æå››, ç‹äº”">
                    </div>
                    <div class="form-group">
                        <label>åº§ä½</label>
                        <input type="text" id="showSeat" placeholder="ä¾‹å¦‚ï¼šä¸€æ¥¼5æ’8åº§">
                    </div>
                    <div class="form-group">
                        <label>å¤‡æ³¨</label>
                        <textarea id="showNotes" placeholder="è®°å½•ä½ çš„è§‚æ¼”æ„Ÿå—..."></textarea>
                    </div>
                    <div class="form-group">
                        <label>ç…§ç‰‡ï¼ˆå¯é€‰ï¼‰</label>
                        <input type="file" id="showImages" accept="image/*" multiple class="image-upload">
                        <div id="imagePreview" class="image-preview"></div>
                    </div>
                    <button type="submit" class="btn">ä¿å­˜è®°å½•</button>
                </form>
            </div>
        </div>

        <!-- æ‰€æœ‰è®°å½• -->
        <div id="tab-list" class="tab-content">
            <div class="card">
                <h2 class="card-title">æ‰€æœ‰è§‚æ¼”è®°å½•</h2>
                <div id="recordsList" class="records-list"></div>
            </div>
        </div>

        <!-- æ—¥å†è§†å›¾ -->
        <div id="tab-calendar" class="tab-content">
            <div class="card">
                <div class="calendar-container">
                    <div class="calendar-header">
                        <h2 class="calendar-title" id="calendarTitle"></h2>
                        <div class="calendar-nav">
                            <button class="btn btn-small" onclick="changeMonth(-1)">â† ä¸Šæœˆ</button>
                            <button class="btn btn-small btn-secondary" onclick="goToToday()">ä»Šå¤©</button>
                            <button class="btn btn-small" onclick="changeMonth(1)">ä¸‹æœˆ â†’</button>
                        </div>
                    </div>
                    <div class="calendar-grid" id="calendarGrid"></div>
                </div>
            </div>
        </div>

        <!-- å‰§ç›®æ’è¡Œ -->
        <div id="tab-shows" class="tab-content">
            <div class="card">
                <h2 class="card-title">å‰§ç›®è§‚çœ‹æ¬¡æ•°æ’è¡Œ</h2>
                <div id="showsRanking"></div>
            </div>
        </div>

        <!-- æ¼”å‘˜æ’è¡Œ -->
        <div id="tab-actors" class="tab-content">
            <div class="card">
                <h2 class="card-title">æ¼”å‘˜è§‚çœ‹æ¬¡æ•°æ’è¡Œ</h2>
                <div id="actorsRanking"></div>
            </div>
        </div>

        <!-- ç»Ÿè®¡æ€»ç»“ -->
        <div id="tab-summary" class="tab-content">
            <div class="card">
                <h2 class="card-title">è§‚æ¼”ç»Ÿè®¡</h2>
                <div class="stats-grid" id="statsOverall"></div>
                
                <h3 class="card-title" style="margin-top: 30px;">æœˆåº¦ç»Ÿè®¡</h3>
                <div id="monthlyStats"></div>
                
                <h3 class="card-title" style="margin-top: 30px;">å¹´åº¦ç»Ÿè®¡</h3>
                <div id="yearlyStats"></div>
            </div>
        </div>

        <!-- æ•°æ®ç®¡ç† -->
        <div id="tab-data" class="tab-content">
            <div class="card">
                <h2 class="card-title">æ•°æ®ç®¡ç†</h2>
                
                <!-- GitHub è‡ªåŠ¨åŒæ­¥è®¾ç½® -->
                <div style="padding: 25px; background: linear-gradient(135deg, #E8F5E9 0%, #C8E6C9 100%); border-radius: 12px; margin-bottom: 30px; border: 2px solid #81C784;">
                    <h3 style="font-size: 1.3em; margin-bottom: 15px; color: #2E7D32;">ğŸ”„ GitHub è‡ªåŠ¨åŒæ­¥</h3>
                    <p style="color: #1B5E20; margin-bottom: 20px; line-height: 1.8;">
                        å¯ç”¨åï¼Œæ‰€æœ‰è®°å½•å°†è‡ªåŠ¨ä¿å­˜åˆ°ä½ çš„GitHubä»“åº“ï¼Œå®ç°è·¨è®¾å¤‡è‡ªåŠ¨åŒæ­¥ã€‚åªéœ€è®¾ç½®ä¸€æ¬¡ï¼Œæ°¸ä¹…æœ‰æ•ˆï¼
                    </p>
                    
                    <div id="githubStatus" style="margin-bottom: 20px; padding: 15px; background: white; border-radius: 8px;">
                        <div style="font-weight: 600; margin-bottom: 8px;">åŒæ­¥çŠ¶æ€ï¼š<span id="syncStatusText">æœªå¯ç”¨</span></div>
                        <div style="font-size: 0.9em; color: var(--text-secondary);" id="syncStatusDetail">è¯·å…ˆé…ç½®GitHub Token</div>
                    </div>
                    
                    <div style="margin-bottom: 15px;">
                        <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #1B5E20;">GitHub Tokenï¼ˆè®¿é—®ä»¤ç‰Œï¼‰</label>
                        <input type="password" id="githubToken" placeholder="ç²˜è´´ä½ çš„ GitHub Token (ghp_...)" 
                               style="width: 100%; padding: 12px; border: 2px solid #81C784; border-radius: 8px; font-family: monospace;">
                        <div style="font-size: 0.85em; color: #2E7D32; margin-top: 5px;">
                            Tokenå·²åŠ å¯†ä¿å­˜åœ¨æœ¬åœ°ï¼Œä¸ä¼šæ³„éœ²
                        </div>
                    </div>
                    
                    <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                        <button class="btn" onclick="saveGitHubToken()" style="background: #2E7D32;">ä¿å­˜Tokenå¹¶å¯ç”¨åŒæ­¥</button>
                        <button class="btn btn-secondary" onclick="testGitHubConnection()">æµ‹è¯•è¿æ¥</button>
                        <button class="btn" onclick="manualSync()" style="background: #1976D2;">ç«‹å³åŒæ­¥</button>
                    </div>
                </div>
                
                <p style="color: var(--text-secondary); margin-bottom: 30px;">
                    é€šè¿‡å¯¼å‡ºå’Œå¯¼å…¥åŠŸèƒ½ï¼Œä½ ä¹Ÿå¯ä»¥æ‰‹åŠ¨åœ¨ä¸åŒè®¾å¤‡é—´åŒæ­¥è§‚æ¼”è®°å½•ã€‚
                </p>
                
                <div style="display: grid; gap: 20px; margin-bottom: 30px;">
                    <div style="padding: 25px; background: var(--bg-main); border-radius: 12px; border-left: 4px solid var(--primary);">
                        <h3 style="font-size: 1.2em; margin-bottom: 12px; color: var(--primary);">ğŸ“¤ å¯¼å‡ºæ•°æ®</h3>
                        <p style="color: var(--text-secondary); margin-bottom: 15px; font-size: 0.95em;">
                            å°†æ‰€æœ‰è®°å½•å¯¼å‡ºä¸ºJSONæ–‡ä»¶ï¼Œå¯ä»¥ä¿å­˜åˆ°äº‘ç›˜æˆ–å‘é€åˆ°å…¶ä»–è®¾å¤‡ã€‚
                        </p>
                        <button class="btn" onclick="exportData()">å¯¼å‡ºæ‰€æœ‰è®°å½•</button>
                    </div>
                    
                    <div style="padding: 25px; background: var(--bg-main); border-radius: 12px; border-left: 4px solid var(--secondary);">
                        <h3 style="font-size: 1.2em; margin-bottom: 12px; color: var(--primary);">ğŸ“¥ å¯¼å…¥æ•°æ®</h3>
                        <p style="color: var(--text-secondary); margin-bottom: 15px; font-size: 0.95em;">
                            ä»ä¹‹å‰å¯¼å‡ºçš„æ–‡ä»¶ä¸­æ¢å¤è®°å½•ã€‚å¯ä»¥é€‰æ‹©è¦†ç›–å½“å‰æ•°æ®æˆ–åˆå¹¶æ•°æ®ã€‚
                        </p>
                        <input type="file" id="importFile" accept=".json" style="display: none;" onchange="handleImportFile(event)">
                        <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                            <button class="btn btn-secondary" onclick="document.getElementById('importFile').click()">é€‰æ‹©æ–‡ä»¶å¯¼å…¥</button>
                        </div>
                    </div>
                </div>
                
                <div style="padding: 20px; background: #FFF9E6; border-radius: 12px; border: 2px solid #FFE4A3;">
                    <h3 style="font-size: 1.1em; margin-bottom: 10px; color: #8B7500;">ğŸ’¡ ä½¿ç”¨æç¤º</h3>
                    <ul style="color: #6B5500; line-height: 1.8; margin-left: 20px;">
                        <li><strong>GitHubåŒæ­¥</strong>ï¼šå¯ç”¨åæ¯æ¬¡ä¿å­˜éƒ½ä¼šè‡ªåŠ¨ä¸Šä¼ åˆ°GitHubï¼Œå…¶ä»–è®¾å¤‡æ‰“å¼€ç½‘ç«™æ—¶è‡ªåŠ¨åŠ è½½æœ€æ–°æ•°æ®</li>
                        <li><strong>æ‰‹åŠ¨å¯¼å‡º</strong>ï¼šå®šæœŸå¯¼å‡ºæ•°æ®ä½œä¸ºå¤‡ä»½ï¼Œé˜²æ­¢æ•°æ®ä¸¢å¤±</li>
                        <li>å¯¼å‡ºçš„æ–‡ä»¶å¯ä»¥ä¿å­˜åˆ°äº‘ç›˜ï¼ˆå¦‚ç™¾åº¦ç½‘ç›˜ã€iCloudç­‰ï¼‰</li>
                        <li>åœ¨æ–°è®¾å¤‡ä¸Šæ‰“å¼€ç½‘ç«™åï¼Œå¯¼å…¥ä¹‹å‰å¯¼å‡ºçš„æ–‡ä»¶å³å¯æ¢å¤æ•°æ®</li>
                        <li>å¯¼å…¥æ—¶ä¼šæç¤ºä½ é€‰æ‹©è¦†ç›–æˆ–åˆå¹¶ï¼Œåˆå¹¶æ¨¡å¼ä¼šä¿ç•™ä¸¤è¾¹çš„æ•°æ®</li>
                    </ul>
                </div>
                
                <div style="margin-top: 30px; padding: 20px; background: #FFE5E5; border-radius: 12px; border: 2px solid #FFB3B3;">
                    <h3 style="font-size: 1.1em; margin-bottom: 10px; color: #C00000;">âš ï¸ å±é™©æ“ä½œ</h3>
                    <p style="color: var(--text-secondary); margin-bottom: 15px; font-size: 0.95em;">
                        æ¸…ç©ºæ‰€æœ‰æ•°æ®å°†æ— æ³•æ¢å¤ï¼Œè¯·è°¨æ…æ“ä½œã€‚å»ºè®®å…ˆå¯¼å‡ºå¤‡ä»½ã€‚
                    </p>
                    <button class="btn" onclick="clearAllData()" style="background: #dc3545;">æ¸…ç©ºæ‰€æœ‰æ•°æ®</button>
                </div>
            </div>
        </div>
    </div>

    <!-- ç¼–è¾‘æ¨¡æ€æ¡† -->
    <div id="editModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">ç¼–è¾‘è®°å½•</h3>
                <button class="close-btn" onclick="closeEditModal()">Ã—</button>
            </div>
            <form id="editForm">
                <input type="hidden" id="editId">
                <div class="form-group">
                    <label>å‰§ç›®åç§° *</label>
                    <input type="text" id="editShowName" required>
                </div>
                <div class="form-group">
                    <label>å‰§ç§ *</label>
                    <input type="text" id="editShowType" required>
                </div>
                <div class="form-group">
                    <label>è§‚æ¼”æ—¥æœŸ *</label>
                    <input type="date" id="editShowDate" required>
                </div>
                <div class="form-group">
                    <label>å…·ä½“æ—¶é—´</label>
                    <input type="time" id="editShowTime">
                </div>
                <div class="form-group">
                    <label>å¡å¸</label>
                    <input type="text" id="editShowCast">
                </div>
                <div class="form-group">
                    <label>åº§ä½</label>
                    <input type="text" id="editShowSeat">
                </div>
                <div class="form-group">
                    <label>å¤‡æ³¨</label>
                    <textarea id="editShowNotes"></textarea>
                </div>
                <div class="form-group">
                    <label>ç…§ç‰‡</label>
                    <div id="editImagePreview" class="image-preview"></div>
                    <input type="file" id="editShowImages" accept="image/*" multiple class="image-upload">
                </div>
                <div style="display: flex; gap: 10px;">
                    <button type="submit" class="btn">ä¿å­˜ä¿®æ”¹</button>
                    <button type="button" class="btn btn-secondary" onclick="closeEditModal()">å–æ¶ˆ</button>
                </div>
            </form>
        </div>
    </div>

    <!-- æ—¥å†è¯¦æƒ…æ¨¡æ€æ¡† -->
    <div id="dayModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="dayModalTitle"></h3>
                <button class="close-btn" onclick="closeDayModal()">Ã—</button>
            </div>
            <div id="dayModalContent"></div>
        </div>
    </div>

    <script>
        // GitHub åŒæ­¥é…ç½®
        const GITHUB_CONFIG = {
            username: 'auriarw',
            repo: 'auriarw.github.io',
            branch: 'main',
            dataFile: 'show-records-data.json',
            token: '' // å°†åœ¨è®¾ç½®ä¸­é…ç½®
        };
        
        // æ•°æ®å­˜å‚¨
        let records = JSON.parse(localStorage.getItem('musicalRecords') || '[]');
        let currentMonth = new Date();
        let currentEditId = null;
        let tempImages = [];
        let editTempImages = [];
        let isSyncing = false;

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            console.log('é¡µé¢åŠ è½½å®Œæˆ');
            
            // åŠ è½½GitHubé…ç½®
            loadGitHubConfig();
            
            // å°è¯•ä»GitHubåŠ è½½æ•°æ®
            syncFromGitHub().then(() => {
                console.log('å½“å‰è®°å½•æ•°:', records.length);
                loadRecords();
                renderCalendar();
            }).catch(err => {
                console.log('GitHubåŒæ­¥å¤±è´¥ï¼Œä½¿ç”¨æœ¬åœ°æ•°æ®:', err.message);
                console.log('å½“å‰è®°å½•æ•°:', records.length);
                loadRecords();
                renderCalendar();
            });
            
            // è¡¨å•æäº¤
            const addForm = document.getElementById('addForm');
            if (addForm) {
                addForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    console.log('è¡¨å•æäº¤è¢«è§¦å‘');
                    addRecord();
                    return false;
                });
            }
            
            const editForm = document.getElementById('editForm');
            if (editForm) {
                editForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    updateRecord();
                    return false;
                });
            }
            
            // å›¾ç‰‡ä¸Šä¼ é¢„è§ˆ
            document.getElementById('showImages').addEventListener('change', handleImageUpload);
            document.getElementById('editShowImages').addEventListener('change', handleEditImageUpload);
            
            // åŠ è½½ä¿å­˜çš„tokenåˆ°è¾“å…¥æ¡†
            if (GITHUB_CONFIG.token) {
                document.getElementById('githubToken').value = GITHUB_CONFIG.token;
            }
        });

        // åˆ‡æ¢æ ‡ç­¾é¡µ
        function switchTab(tabName) {
            document.querySelectorAll('.nav-tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            // æ‰¾åˆ°è¢«ç‚¹å‡»çš„æ ‡ç­¾
            const tabs = document.querySelectorAll('.nav-tab');
            tabs.forEach(tab => {
                const text = tab.textContent.trim();
                if (text.includes('æ·»åŠ è®°å½•') && tabName === 'add') tab.classList.add('active');
                if (text.includes('æ‰€æœ‰è®°å½•') && tabName === 'list') tab.classList.add('active');
                if (text.includes('æ—¥å†è§†å›¾') && tabName === 'calendar') tab.classList.add('active');
                if (text.includes('å‰§ç›®æ’è¡Œ') && tabName === 'shows') tab.classList.add('active');
                if (text.includes('æ¼”å‘˜æ’è¡Œ') && tabName === 'actors') tab.classList.add('active');
                if (text.includes('ç»Ÿè®¡æ€»ç»“') && tabName === 'summary') tab.classList.add('active');
                if (text.includes('æ•°æ®ç®¡ç†') && tabName === 'data') tab.classList.add('active');
            });
            
            document.getElementById('tab-' + tabName).classList.add('active');
            
            // åŠ è½½å¯¹åº”å†…å®¹
            if (tabName === 'list') loadRecords();
            if (tabName === 'calendar') renderCalendar();
            if (tabName === 'shows') renderShowsRanking();
            if (tabName === 'actors') renderActorsRanking();
            if (tabName === 'summary') renderSummary();
        }

        // å›¾ç‰‡ä¸Šä¼ å¤„ç†
        function handleImageUpload(e) {
            const files = Array.from(e.target.files);
            tempImages = [];
            
            files.forEach(file => {
                const reader = new FileReader();
                reader.onload = function(event) {
                    tempImages.push(event.target.result);
                    renderImagePreview('imagePreview', tempImages);
                };
                reader.readAsDataURL(file);
            });
        }

        function handleEditImageUpload(e) {
            const files = Array.from(e.target.files);
            
            files.forEach(file => {
                const reader = new FileReader();
                reader.onload = function(event) {
                    editTempImages.push(event.target.result);
                    renderImagePreview('editImagePreview', editTempImages);
                };
                reader.readAsDataURL(file);
            });
        }

        function renderImagePreview(containerId, images) {
            const container = document.getElementById(containerId);
            container.innerHTML = images.map((img, index) => `
                <div class="image-preview-item">
                    <img src="${img}" alt="é¢„è§ˆ">
                    <button type="button" class="image-remove" onclick="removeImage('${containerId}', ${index})">Ã—</button>
                </div>
            `).join('');
        }

        function removeImage(containerId, index) {
            if (containerId === 'imagePreview') {
                tempImages.splice(index, 1);
                renderImagePreview('imagePreview', tempImages);
            } else {
                editTempImages.splice(index, 1);
                renderImagePreview('editImagePreview', editTempImages);
            }
        }

        // æ·»åŠ è®°å½•
        function addRecord() {
            console.log('addRecordå‡½æ•°è¢«è°ƒç”¨');
            
            const showName = document.getElementById('showName').value;
            const showType = document.getElementById('showType').value;
            const date = document.getElementById('showDate').value;
            
            console.log('è¡¨å•æ•°æ®:', { showName, showType, date });
            
            if (!showName || !showType || !date) {
                alert('è¯·å¡«å†™å¿…å¡«é¡¹ï¼šå‰§ç›®åç§°ã€å‰§ç§å’Œè§‚æ¼”æ—¥æœŸ');
                return;
            }
            
            const record = {
                id: Date.now(),
                showName: showName,
                showType: showType,
                date: date,
                time: document.getElementById('showTime').value,
                cast: document.getElementById('showCast').value.split(',').map(s => s.trim()).filter(s => s),
                seat: document.getElementById('showSeat').value,
                notes: document.getElementById('showNotes').value,
                images: [...tempImages], // å¤åˆ¶æ•°ç»„
                createdAt: new Date().toISOString()
            };
            
            console.log('åˆ›å»ºçš„è®°å½•:', record);
            
            records.push(record);
            console.log('æ·»åŠ åæ€»è®°å½•æ•°:', records.length);
            
            saveRecords();
            console.log('ä¿å­˜åˆ°localStorageå®Œæˆ');
            
            // é‡ç½®è¡¨å•å’Œå›¾ç‰‡
            document.getElementById('addForm').reset();
            tempImages = [];
            document.getElementById('imagePreview').innerHTML = '';
            
            alert('è®°å½•æ·»åŠ æˆåŠŸï¼\nå·²ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨\nå½“å‰å…±æœ‰ ' + records.length + ' æ¡è®°å½•');
            
            // ä¿æŒåœ¨æ·»åŠ è®°å½•é¡µé¢ï¼Œä¸è·³è½¬
        }

        // åŠ è½½è®°å½•åˆ—è¡¨
        function loadRecords() {
            const container = document.getElementById('recordsList');
            
            if (records.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">ğŸ­</div>
                        <p>è¿˜æ²¡æœ‰è§‚æ¼”è®°å½•ï¼Œå¿«å»æ·»åŠ ç¬¬ä¸€æ¡è®°å½•å§ï¼</p>
                    </div>
                `;
                return;
            }
            
            const sortedRecords = [...records].sort((a, b) => new Date(b.date) - new Date(a.date));
            
            container.innerHTML = sortedRecords.map(record => `
                <div class="record-item">
                    <div class="record-header">
                        <div>
                            <div class="record-title">${record.showName}</div>
                            <span class="record-type">${record.showType}</span>
                        </div>
                    </div>
                    <div class="record-details">
                        <div class="record-detail">ğŸ“… ${formatDate(record.date)}</div>
                        ${record.time ? `<div class="record-detail">â° ${record.time}</div>` : ''}
                        ${record.seat ? `<div class="record-detail">ğŸ’º ${record.seat}</div>` : ''}
                        ${record.cast.length > 0 ? `<div class="record-detail">â­ ${record.cast.join(', ')}</div>` : ''}
                    </div>
                    ${record.notes ? `<div style="margin-top: 12px; color: var(--text-secondary);">${record.notes}</div>` : ''}
                    ${record.images && record.images.length > 0 ? `
                        <div class="image-preview" style="margin-top: 12px;">
                            ${record.images.map(img => `
                                <div class="image-preview-item">
                                    <img src="${img}" alt="æ¼”å‡ºç…§ç‰‡">
                                </div>
                            `).join('')}
                        </div>
                    ` : ''}
                    <div class="record-actions">
                        <button class="btn btn-small btn-secondary" onclick="editRecord(${record.id})">ç¼–è¾‘</button>
                        <button class="btn btn-small" onclick="deleteRecord(${record.id})" style="background: #dc3545;">åˆ é™¤</button>
                    </div>
                </div>
            `).join('');
        }

        // ç¼–è¾‘è®°å½•
        function editRecord(id) {
            const record = records.find(r => r.id === id);
            if (!record) return;
            
            currentEditId = id;
            editTempImages = record.images || [];
            
            document.getElementById('editId').value = record.id;
            document.getElementById('editShowName').value = record.showName;
            document.getElementById('editShowType').value = record.showType;
            document.getElementById('editShowDate').value = record.date;
            document.getElementById('editShowTime').value = record.time || '';
            document.getElementById('editShowCast').value = record.cast.join(', ');
            document.getElementById('editShowSeat').value = record.seat || '';
            document.getElementById('editShowNotes').value = record.notes || '';
            
            renderImagePreview('editImagePreview', editTempImages);
            
            document.getElementById('editModal').classList.add('active');
        }

        // æ›´æ–°è®°å½•
        function updateRecord() {
            const id = parseInt(document.getElementById('editId').value);
            const index = records.findIndex(r => r.id === id);
            
            if (index !== -1) {
                records[index] = {
                    ...records[index],
                    showName: document.getElementById('editShowName').value,
                    showType: document.getElementById('editShowType').value,
                    date: document.getElementById('editShowDate').value,
                    time: document.getElementById('editShowTime').value,
                    cast: document.getElementById('editShowCast').value.split(',').map(s => s.trim()).filter(s => s),
                    seat: document.getElementById('editShowSeat').value,
                    notes: document.getElementById('editShowNotes').value,
                    images: editTempImages
                };
                
                saveRecords();
                closeEditModal();
                alert('è®°å½•æ›´æ–°æˆåŠŸï¼');
                
                // åˆ·æ–°å½“å‰è§†å›¾
                const activeTab = document.querySelector('.tab-content.active');
                if (activeTab.id === 'tab-list') {
                    loadRecords();
                } else if (activeTab.id === 'tab-calendar') {
                    renderCalendar();
                }
            }
        }

        // åˆ é™¤è®°å½•
        function deleteRecord(id) {
            if (confirm('ç¡®å®šè¦åˆ é™¤è¿™æ¡è®°å½•å—ï¼Ÿ')) {
                records = records.filter(r => r.id !== id);
                saveRecords();
                
                // åˆ·æ–°å½“å‰è§†å›¾
                const activeTab = document.querySelector('.tab-content.active');
                if (activeTab.id === 'tab-list') {
                    loadRecords();
                } else if (activeTab.id === 'tab-calendar') {
                    renderCalendar();
                }
            }
        }

        // å…³é—­ç¼–è¾‘æ¨¡æ€æ¡†
        function closeEditModal() {
            document.getElementById('editModal').classList.remove('active');
            currentEditId = null;
            editTempImages = [];
        }

        // æ¸²æŸ“æ—¥å†
        function renderCalendar() {
            const year = currentMonth.getFullYear();
            const month = currentMonth.getMonth();
            
            document.getElementById('calendarTitle').textContent = `${year}å¹´${month + 1}æœˆ`;
            
            const firstDay = new Date(year, month, 1).getDay();
            const daysInMonth = new Date(year, month + 1, 0).getDate();
            const daysInPrevMonth = new Date(year, month, 0).getDate();
            
            const grid = document.getElementById('calendarGrid');
            grid.innerHTML = '';
            
            // æ˜ŸæœŸæ ‡é¢˜
            const weekdays = ['æ—¥', 'ä¸€', 'äºŒ', 'ä¸‰', 'å››', 'äº”', 'å…­'];
            weekdays.forEach(day => {
                const header = document.createElement('div');
                header.className = 'calendar-day-header';
                header.textContent = day;
                grid.appendChild(header);
            });
            
            // ä¸Šæœˆæ—¥æœŸ
            for (let i = firstDay - 1; i >= 0; i--) {
                const day = daysInPrevMonth - i;
                const dayEl = createCalendarDay(day, year, month - 1, true);
                grid.appendChild(dayEl);
            }
            
            // å½“æœˆæ—¥æœŸ
            for (let day = 1; day <= daysInMonth; day++) {
                const dayEl = createCalendarDay(day, year, month, false);
                grid.appendChild(dayEl);
            }
            
            // ä¸‹æœˆæ—¥æœŸ
            const remainingDays = 42 - (firstDay + daysInMonth);
            for (let day = 1; day <= remainingDays; day++) {
                const dayEl = createCalendarDay(day, year, month + 1, true);
                grid.appendChild(dayEl);
            }
        }

        function createCalendarDay(day, year, month, isOtherMonth) {
            const dateStr = `${year}-${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
            let dayRecords = records.filter(r => r.date === dateStr);
            
            // æŒ‰æ—¶é—´æ’åº
            dayRecords.sort((a, b) => {
                if (!a.time && !b.time) return 0;
                if (!a.time) return 1;
                if (!b.time) return -1;
                return a.time.localeCompare(b.time);
            });
            
            const dayEl = document.createElement('div');
            dayEl.className = 'calendar-day';
            if (isOtherMonth) dayEl.classList.add('other-month');
            if (dayRecords.length > 0) dayEl.classList.add('has-show');
            
            // æ£€æŸ¥æ˜¯å¦æœ‰ä»»ä½•è®°å½•åŒ…å«å›¾ç‰‡
            const hasAnyImage = dayRecords.some(r => r.images && r.images.length > 0);
            
            let contentHtml = '';
            
            if (hasAnyImage) {
                // å¦‚æœæœ‰å›¾ç‰‡ï¼Œåªæ˜¾ç¤ºç¬¬ä¸€ä¸ªæœ‰å›¾ç‰‡çš„è®°å½•ï¼Œå¹¶è®©å›¾ç‰‡å æ»¡æ•´ä¸ªæ ¼å­
                const recordWithImage = dayRecords.find(r => r.images && r.images.length > 0);
                contentHtml = `
                    <div class="day-image-full">
                        <img src="${recordWithImage.images[0]}" alt="${recordWithImage.showName}">
                        <div class="day-image-overlay">${recordWithImage.showName}</div>
                    </div>
                `;
            } else {
                // å¦‚æœæ²¡æœ‰å›¾ç‰‡ï¼Œåªæ˜¾ç¤ºå‰§å
                contentHtml = `
                    <div class="day-text-only">
                        ${dayRecords.map(record => `
                            <div class="day-text-item">${record.showName}</div>
                        `).join('')}
                    </div>
                `;
            }
            
            dayEl.innerHTML = `
                <div class="day-number">${day}</div>
                <div class="day-content">
                    ${contentHtml}
                </div>
            `;
            
            if (dayRecords.length > 0) {
                dayEl.onclick = () => showDayDetail(dateStr, dayRecords);
            }
            
            return dayEl;
        }

        function showDayDetail(date, dayRecords) {
            document.getElementById('dayModalTitle').textContent = formatDate(date);
            document.getElementById('dayModalContent').innerHTML = dayRecords.map(record => `
                <div class="record-item" style="margin-bottom: 15px;">
                    <div class="record-title">${record.showName}</div>
                    <div class="record-type">${record.showType}</div>
                    ${record.time ? `<div style="margin-top: 8px;">â° ${record.time}</div>` : ''}
                    ${record.cast.length > 0 ? `<div style="margin-top: 4px;">â­ ${record.cast.join(', ')}</div>` : ''}
                    ${record.seat ? `<div style="margin-top: 4px;">ğŸ’º ${record.seat}</div>` : ''}
                    ${record.notes ? `<div style="margin-top: 8px; color: var(--text-secondary);">${record.notes}</div>` : ''}
                    ${record.images && record.images.length > 0 ? `
                        <div class="image-preview" style="margin-top: 10px;">
                            ${record.images.map(img => `
                                <div class="image-preview-item" style="width: 120px; height: 120px;">
                                    <img src="${img}" alt="æ¼”å‡ºç…§ç‰‡">
                                </div>
                            `).join('')}
                        </div>
                    ` : ''}
                </div>
            `).join('');
            document.getElementById('dayModal').classList.add('active');
        }

        function closeDayModal() {
            document.getElementById('dayModal').classList.remove('active');
        }

        function changeMonth(delta) {
            currentMonth.setMonth(currentMonth.getMonth() + delta);
            renderCalendar();
        }

        function goToToday() {
            currentMonth = new Date();
            renderCalendar();
        }

        // å‰§ç›®æ’è¡Œ
        function renderShowsRanking() {
            const showCounts = {};
            records.forEach(record => {
                showCounts[record.showName] = (showCounts[record.showName] || 0) + 1;
            });
            
            const sorted = Object.entries(showCounts).sort((a, b) => b[1] - a[1]);
            const container = document.getElementById('showsRanking');
            
            if (sorted.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">ğŸ­</div>
                        <p>æš‚æ— å‰§ç›®æ•°æ®</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = sorted.map(([name, count], index) => `
                <div class="ranking-item">
                    <div class="ranking-number ${index < 3 ? 'top' : ''}">${index + 1}</div>
                    <div class="ranking-name">${name}</div>
                    <div class="ranking-count">${count} æ¬¡</div>
                </div>
            `).join('');
        }

        // æ¼”å‘˜æ’è¡Œ
        function renderActorsRanking() {
            const actorCounts = {};
            records.forEach(record => {
                record.cast.forEach(actor => {
                    if (actor) {
                        actorCounts[actor] = (actorCounts[actor] || 0) + 1;
                    }
                });
            });
            
            const sorted = Object.entries(actorCounts).sort((a, b) => b[1] - a[1]);
            const container = document.getElementById('actorsRanking');
            
            if (sorted.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">â­</div>
                        <p>æš‚æ— æ¼”å‘˜æ•°æ®</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = sorted.map(([name, count], index) => `
                <div class="ranking-item">
                    <div class="ranking-number ${index < 3 ? 'top' : ''}">${index + 1}</div>
                    <div class="ranking-name">${name}</div>
                    <div class="ranking-count">${count} æ¬¡</div>
                </div>
            `).join('');
        }

        // ç»Ÿè®¡æ€»ç»“
        function renderSummary() {
            // æ€»ä½“ç»Ÿè®¡
            const totalShows = records.length;
            const uniqueShows = new Set(records.map(r => r.showName)).size;
            const uniqueActors = new Set(records.flatMap(r => r.cast)).size;
            
            document.getElementById('statsOverall').innerHTML = `
                <div class="stat-card">
                    <span class="stat-number">${totalShows}</span>
                    <span class="stat-label">æ€»è§‚æ¼”åœºæ¬¡</span>
                </div>
                <div class="stat-card">
                    <span class="stat-number">${uniqueShows}</span>
                    <span class="stat-label">ä¸åŒå‰§ç›®</span>
                </div>
                <div class="stat-card">
                    <span class="stat-number">${uniqueActors}</span>
                    <span class="stat-label">ä¸åŒæ¼”å‘˜</span>
                </div>
            `;
            
            // æœˆåº¦ç»Ÿè®¡
            const monthlyData = {};
            records.forEach(record => {
                const month = record.date.substring(0, 7);
                monthlyData[month] = (monthlyData[month] || 0) + 1;
            });
            
            const sortedMonths = Object.entries(monthlyData).sort((a, b) => b[0].localeCompare(a[0]));
            document.getElementById('monthlyStats').innerHTML = sortedMonths.map(([month, count]) => `
                <div class="ranking-item">
                    <div class="ranking-name">${month}</div>
                    <div class="ranking-count">${count} åœº</div>
                </div>
            `).join('');
            
            // å¹´åº¦ç»Ÿè®¡
            const yearlyData = {};
            records.forEach(record => {
                const year = record.date.substring(0, 4);
                yearlyData[year] = (yearlyData[year] || 0) + 1;
            });
            
            const sortedYears = Object.entries(yearlyData).sort((a, b) => b[0].localeCompare(a[0]));
            document.getElementById('yearlyStats').innerHTML = sortedYears.map(([year, count]) => `
                <div class="ranking-item">
                    <div class="ranking-name">${year}å¹´</div>
                    <div class="ranking-count">${count} åœº</div>
                </div>
            `).join('');
        }

        // å·¥å…·å‡½æ•°
        function formatDate(dateStr) {
            const date = new Date(dateStr);
            return `${date.getFullYear()}å¹´${date.getMonth() + 1}æœˆ${date.getDate()}æ—¥`;
        }

        function saveRecords() {
            try {
                const dataStr = JSON.stringify(records);
                localStorage.setItem('musicalRecords', dataStr);
                console.log('æ•°æ®å·²ä¿å­˜åˆ°localStorageï¼Œå…±', records.length, 'æ¡è®°å½•');
                
                // å¦‚æœå¯ç”¨äº†GitHubåŒæ­¥ï¼Œè‡ªåŠ¨ä¸Šä¼ 
                if (GITHUB_CONFIG.token && !isSyncing) {
                    syncToGitHub().catch(err => {
                        console.error('GitHubåŒæ­¥å¤±è´¥:', err);
                    });
                }
                
                return true;
            } catch (error) {
                console.error('ä¿å­˜å¤±è´¥:', error);
                alert('ä¿å­˜å¤±è´¥: ' + error.message);
                return false;
            }
        }

        // å¯¼å‡ºæ•°æ®
        function exportData() {
            if (records.length === 0) {
                alert('å½“å‰æ²¡æœ‰ä»»ä½•è®°å½•å¯ä»¥å¯¼å‡º');
                return;
            }
            
            const dataStr = JSON.stringify(records, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            
            // ä½¿ç”¨å½“å‰æ—¥æœŸä½œä¸ºæ–‡ä»¶å
            const date = new Date();
            const fileName = `è§‚æ¼”è®°å½•_${date.getFullYear()}${String(date.getMonth() + 1).padStart(2, '0')}${String(date.getDate()).padStart(2, '0')}.json`;
            link.download = fileName;
            
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);
            
            alert(`æ•°æ®å¯¼å‡ºæˆåŠŸï¼\nå…±å¯¼å‡º ${records.length} æ¡è®°å½•`);
        }

        // å¤„ç†å¯¼å…¥æ–‡ä»¶
        function handleImportFile(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const importedData = JSON.parse(e.target.result);
                    
                    if (!Array.isArray(importedData)) {
                        alert('æ–‡ä»¶æ ¼å¼é”™è¯¯ï¼Œè¯·é€‰æ‹©æ­£ç¡®çš„å¯¼å‡ºæ–‡ä»¶');
                        return;
                    }
                    
                    // è¯¢é—®ç”¨æˆ·æ˜¯è¦†ç›–è¿˜æ˜¯åˆå¹¶
                    const action = confirm(
                        `æ£€æµ‹åˆ° ${importedData.length} æ¡è®°å½•\n\n` +
                        `å½“å‰æœ‰ ${records.length} æ¡è®°å½•\n\n` +
                        `ç‚¹å‡»"ç¡®å®š"åˆå¹¶æ•°æ®ï¼ˆä¿ç•™ç°æœ‰è®°å½•ï¼‰\n` +
                        `ç‚¹å‡»"å–æ¶ˆ"è¦†ç›–æ•°æ®ï¼ˆæ›¿æ¢æ‰€æœ‰è®°å½•ï¼‰`
                    );
                    
                    if (action) {
                        // åˆå¹¶æ•°æ®
                        const existingIds = new Set(records.map(r => r.id));
                        const newRecords = importedData.filter(r => !existingIds.has(r.id));
                        records = [...records, ...newRecords];
                        alert(`å¯¼å…¥æˆåŠŸï¼\næ–°å¢ ${newRecords.length} æ¡è®°å½•\næ€»è®¡ ${records.length} æ¡è®°å½•`);
                    } else {
                        // è¦†ç›–æ•°æ®
                        if (confirm('ç¡®å®šè¦è¦†ç›–æ‰€æœ‰ç°æœ‰æ•°æ®å—ï¼Ÿæ­¤æ“ä½œæ— æ³•æ’¤é”€ï¼')) {
                            records = importedData;
                            alert(`å¯¼å…¥æˆåŠŸï¼\nå·²è¦†ç›–ä¸º ${records.length} æ¡è®°å½•`);
                        } else {
                            return;
                        }
                    }
                    
                    saveRecords();
                    loadRecords();
                    
                } catch (error) {
                    alert('æ–‡ä»¶è§£æå¤±è´¥ï¼Œè¯·ç¡®ä¿é€‰æ‹©çš„æ˜¯æ­£ç¡®çš„å¯¼å‡ºæ–‡ä»¶');
                    console.error(error);
                }
            };
            
            reader.readAsText(file);
            event.target.value = ''; // é‡ç½®æ–‡ä»¶è¾“å…¥
        }

        // æ¸…ç©ºæ‰€æœ‰æ•°æ®
        function clearAllData() {
            if (records.length === 0) {
                alert('å½“å‰æ²¡æœ‰ä»»ä½•æ•°æ®');
                return;
            }
            
            const confirmation = confirm(
                `è­¦å‘Šï¼šæ­¤æ“ä½œå°†åˆ é™¤æ‰€æœ‰ ${records.length} æ¡è®°å½•ï¼\n\n` +
                `æ­¤æ“ä½œæ— æ³•æ’¤é”€ï¼Œå»ºè®®å…ˆå¯¼å‡ºå¤‡ä»½ã€‚\n\n` +
                `ç¡®å®šè¦ç»§ç»­å—ï¼Ÿ`
            );
            
            if (!confirmation) return;
            
            const finalConfirmation = confirm('æœ€åç¡®è®¤ï¼šçœŸçš„è¦åˆ é™¤æ‰€æœ‰æ•°æ®å—ï¼Ÿ');
            
            if (finalConfirmation) {
                records = [];
                saveRecords();
                loadRecords();
                alert('æ‰€æœ‰æ•°æ®å·²æ¸…ç©º');
            }
        }

        // ============ GitHub åŒæ­¥åŠŸèƒ½ ============
        
        // åŠ è½½GitHubé…ç½®
        function loadGitHubConfig() {
            const savedToken = localStorage.getItem('githubToken');
            if (savedToken) {
                GITHUB_CONFIG.token = savedToken;
                updateSyncStatus();
            }
        }
        
        // ä¿å­˜GitHub Token
        function saveGitHubToken() {
            const token = document.getElementById('githubToken').value.trim();
            
            if (!token) {
                alert('è¯·è¾“å…¥GitHub Token');
                return;
            }
            
            if (!token.startsWith('ghp_')) {
                alert('Tokenæ ¼å¼ä¸æ­£ç¡®ï¼Œåº”è¯¥ä»¥ ghp_ å¼€å¤´');
                return;
            }
            
            GITHUB_CONFIG.token = token;
            localStorage.setItem('githubToken', token);
            
            // æµ‹è¯•è¿æ¥
            testGitHubConnection().then(success => {
                if (success) {
                    alert('Tokenä¿å­˜æˆåŠŸï¼GitHubåŒæ­¥å·²å¯ç”¨\n\nç°åœ¨ä½ çš„æ•°æ®ä¼šè‡ªåŠ¨åŒæ­¥åˆ°GitHub');
                    updateSyncStatus();
                }
            });
        }
        
        // æµ‹è¯•GitHubè¿æ¥
        async function testGitHubConnection() {
            if (!GITHUB_CONFIG.token) {
                alert('è¯·å…ˆé…ç½®GitHub Token');
                return false;
            }
            
            updateSyncStatus('æµ‹è¯•ä¸­...');
            
            try {
                const response = await fetch(
                    `https://api.github.com/repos/${GITHUB_CONFIG.username}/${GITHUB_CONFIG.repo}`,
                    {
                        headers: {
                            'Authorization': `token ${GITHUB_CONFIG.token}`,
                            'Accept': 'application/vnd.github.v3+json'
                        }
                    }
                );
                
                if (response.ok) {
                    updateSyncStatus('å·²å¯ç”¨ âœ“', 'è¿æ¥æ­£å¸¸ï¼Œè‡ªåŠ¨åŒæ­¥å·²å¼€å¯');
                    alert('è¿æ¥æˆåŠŸï¼\nå¯ä»¥æ­£å¸¸è®¿é—®ä½ çš„GitHubä»“åº“');
                    return true;
                } else if (response.status === 401) {
                    updateSyncStatus('æœªå¯ç”¨', 'Tokenæ— æ•ˆï¼Œè¯·æ£€æŸ¥');
                    alert('Tokenæ— æ•ˆï¼\nè¯·æ£€æŸ¥Tokenæ˜¯å¦æ­£ç¡®ï¼Œæˆ–æ˜¯å¦å·²è¿‡æœŸ');
                    return false;
                } else if (response.status === 404) {
                    updateSyncStatus('æœªå¯ç”¨', 'ä»“åº“ä¸å­˜åœ¨');
                    alert('æ‰¾ä¸åˆ°ä»“åº“ï¼\nè¯·æ£€æŸ¥ç”¨æˆ·åå’Œä»“åº“åæ˜¯å¦æ­£ç¡®');
                    return false;
                } else {
                    throw new Error(`HTTP ${response.status}`);
                }
            } catch (error) {
                console.error('æµ‹è¯•è¿æ¥å¤±è´¥:', error);
                updateSyncStatus('æœªå¯ç”¨', 'è¿æ¥å¤±è´¥: ' + error.message);
                alert('è¿æ¥å¤±è´¥ï¼š' + error.message + '\n\nè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥');
                return false;
            }
        }
        
        // åŒæ­¥æ•°æ®åˆ°GitHub
        async function syncToGitHub() {
            if (!GITHUB_CONFIG.token) {
                console.log('æœªé…ç½®GitHub Tokenï¼Œè·³è¿‡åŒæ­¥');
                return;
            }
            
            if (isSyncing) {
                console.log('æ­£åœ¨åŒæ­¥ä¸­ï¼Œè·³è¿‡');
                return;
            }
            
            isSyncing = true;
            updateSyncStatus('åŒæ­¥ä¸­...');
            
            try {
                // 1. è·å–å½“å‰æ–‡ä»¶çš„SHAï¼ˆå¦‚æœå­˜åœ¨ï¼‰
                let sha = null;
                try {
                    const getResponse = await fetch(
                        `https://api.github.com/repos/${GITHUB_CONFIG.username}/${GITHUB_CONFIG.repo}/contents/${GITHUB_CONFIG.dataFile}`,
                        {
                            headers: {
                                'Authorization': `token ${GITHUB_CONFIG.token}`,
                                'Accept': 'application/vnd.github.v3+json'
                            }
                        }
                    );
                    
                    if (getResponse.ok) {
                        const data = await getResponse.json();
                        sha = data.sha;
                    }
                } catch (e) {
                    console.log('æ–‡ä»¶ä¸å­˜åœ¨ï¼Œå°†åˆ›å»ºæ–°æ–‡ä»¶');
                }
                
                // 2. ä¸Šä¼ æ•°æ®
                const content = btoa(unescape(encodeURIComponent(JSON.stringify(records, null, 2))));
                const updateData = {
                    message: `æ›´æ–°è§‚æ¼”è®°å½• - ${new Date().toLocaleString('zh-CN')}`,
                    content: content,
                    branch: GITHUB_CONFIG.branch
                };
                
                if (sha) {
                    updateData.sha = sha;
                }
                
                const putResponse = await fetch(
                    `https://api.github.com/repos/${GITHUB_CONFIG.username}/${GITHUB_CONFIG.repo}/contents/${GITHUB_CONFIG.dataFile}`,
                    {
                        method: 'PUT',
                        headers: {
                            'Authorization': `token ${GITHUB_CONFIG.token}`,
                            'Accept': 'application/vnd.github.v3+json',
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(updateData)
                    }
                );
                
                if (!putResponse.ok) {
                    throw new Error(`ä¸Šä¼ å¤±è´¥: ${putResponse.status}`);
                }
                
                console.log('âœ“ æ•°æ®å·²åŒæ­¥åˆ°GitHub');
                updateSyncStatus('å·²å¯ç”¨ âœ“', `æœ€ååŒæ­¥: ${new Date().toLocaleTimeString('zh-CN')}`);
                
            } catch (error) {
                console.error('åŒæ­¥åˆ°GitHubå¤±è´¥:', error);
                updateSyncStatus('åŒæ­¥å¤±è´¥', error.message);
                throw error;
            } finally {
                isSyncing = false;
            }
        }
        
        // ä»GitHubåŠ è½½æ•°æ®
        async function syncFromGitHub() {
            if (!GITHUB_CONFIG.token) {
                console.log('æœªé…ç½®GitHub Tokenï¼Œä½¿ç”¨æœ¬åœ°æ•°æ®');
                return;
            }
            
            try {
                const response = await fetch(
                    `https://api.github.com/repos/${GITHUB_CONFIG.username}/${GITHUB_CONFIG.repo}/contents/${GITHUB_CONFIG.dataFile}`,
                    {
                        headers: {
                            'Authorization': `token ${GITHUB_CONFIG.token}`,
                            'Accept': 'application/vnd.github.v3+json'
                        }
                    }
                );
                
                if (response.ok) {
                    const data = await response.json();
                    const content = decodeURIComponent(escape(atob(data.content)));
                    const githubRecords = JSON.parse(content);
                    
                    // åˆå¹¶GitHubæ•°æ®å’Œæœ¬åœ°æ•°æ®
                    const localRecords = JSON.parse(localStorage.getItem('musicalRecords') || '[]');
                    
                    if (githubRecords.length > localRecords.length) {
                        console.log('GitHubæ•°æ®è¾ƒæ–°ï¼Œä½¿ç”¨GitHubæ•°æ®');
                        records = githubRecords;
                        localStorage.setItem('musicalRecords', JSON.stringify(records));
                    } else if (localRecords.length > githubRecords.length) {
                        console.log('æœ¬åœ°æ•°æ®è¾ƒæ–°ï¼Œå°†åŒæ­¥åˆ°GitHub');
                        records = localRecords;
                        await syncToGitHub();
                    } else {
                        console.log('æ•°æ®å·²åŒæ­¥');
                        records = githubRecords;
                    }
                    
                    updateSyncStatus('å·²å¯ç”¨ âœ“', `å·²åŠ è½½ ${records.length} æ¡è®°å½•`);
                } else if (response.status === 404) {
                    console.log('GitHubä¸Šè¿˜æ²¡æœ‰æ•°æ®æ–‡ä»¶ï¼Œå°†ä¸Šä¼ æœ¬åœ°æ•°æ®');
                    if (records.length > 0) {
                        await syncToGitHub();
                    }
                } else {
                    throw new Error(`åŠ è½½å¤±è´¥: ${response.status}`);
                }
            } catch (error) {
                console.error('ä»GitHubåŠ è½½å¤±è´¥:', error);
                throw error;
            }
        }
        
        // æ‰‹åŠ¨åŒæ­¥
        async function manualSync() {
            if (!GITHUB_CONFIG.token) {
                alert('è¯·å…ˆé…ç½®GitHub Token');
                return;
            }
            
            try {
                await syncFromGitHub();
                await syncToGitHub();
                alert('åŒæ­¥æˆåŠŸï¼\nå·²ä¸GitHubæ•°æ®åŒæ­¥');
                loadRecords();
                renderCalendar();
            } catch (error) {
                alert('åŒæ­¥å¤±è´¥ï¼š' + error.message);
            }
        }
        
        // æ›´æ–°åŒæ­¥çŠ¶æ€æ˜¾ç¤º
        function updateSyncStatus(status, detail) {
            const statusText = document.getElementById('syncStatusText');
            const statusDetail = document.getElementById('syncStatusDetail');
            
            if (statusText && status) {
                statusText.textContent = status;
            }
            
            if (statusDetail && detail) {
                statusDetail.textContent = detail;
            }
            
            // æ ¹æ®tokenæ˜¯å¦å­˜åœ¨æ›´æ–°é»˜è®¤çŠ¶æ€
            if (!status && GITHUB_CONFIG.token) {
                if (statusText) statusText.textContent = 'å·²å¯ç”¨ âœ“';
                if (statusDetail) statusDetail.textContent = 'è‡ªåŠ¨åŒæ­¥å·²å¼€å¯';
            } else if (!status && !GITHUB_CONFIG.token) {
                if (statusText) statusText.textContent = 'æœªå¯ç”¨';
                if (statusDetail) statusDetail.textContent = 'è¯·å…ˆé…ç½®GitHub Token';
            }
        }
    </script>
</body>
</html>
